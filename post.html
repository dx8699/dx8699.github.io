<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文章详情</title>
  <style>
    body { font-family:"Segoe UI",Arial,sans-serif; background:#f4f6f8; margin:0; padding:0; }
    header { background:#24292f; color:#fff; padding:1rem; text-align:center; }
    main { max-width:900px; margin:2rem auto; padding:0 1rem; }
    .post { background:#fff; padding:1.5rem; border-radius:8px;
            box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    .post h2 { margin-top:0; color:#0366d6; }
    .date { font-size:0.85rem; color:#666; margin-bottom:1rem; }
    .toc { background:#f9f9f9; padding:0.8rem 1rem; border-left:4px solid #0366d6;
           margin-bottom:1.2rem; font-size:0.9rem; }
    .toc strong { display:block; margin-bottom:0.5rem; }
    .toc ul { list-style:none; padding-left:0; }
    .toc li { margin:0.3rem 0; }
    .toc a { color:#0366d6; text-decoration:none; }
    .toc a:hover { text-decoration:underline; }
    .content h1, .content h2, .content h3 { margin-top:1.2rem; }
    .content pre { background:#f6f8fa; padding:0.8rem; border-radius:6px; overflow-x:auto; }
    footer { text-align:center; padding:1rem; color:#999; font-size:0.9rem; }
  </style>
  <!-- Markdown 渲染 -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Prism.js 代码高亮 -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>
</head>
<body>
  <header><h1><a href="/" style="color:white;text-decoration:none;">我的博客</a></h1></header>
  <main id="post">加载中...</main>
  <footer>© 2025 我的博客 | Powered by GitHub Pages + Issues</footer>

  <script>
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    async function loadPost() {
      const id = getQueryParam("id");
      if (!id) return;
      const response = await fetch(`https://api.github.com/repos/dx8699/dx8699.github.io/issues/${id}`);
      const issue = await response.json();

      const htmlContent = marked.parse(issue.body || "");
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = htmlContent;

      // TOC 生成
      const headings = tempDiv.querySelectorAll("h1,h2,h3");
      let tocHtml = "";
      if (headings.length > 0) {
        tocHtml = "<div class='toc'><strong>目录</strong><ul>";
        headings.forEach((h, i) => {
          const hid = "heading-" + i;
          h.id = hid;
          tocHtml += `<li><a href="#${hid}">${h.innerText}</a></li>`;
        });
        tocHtml += "</ul></div>";
      }

      document.getElementById("post").innerHTML = `
        <div class="post">
          <h2>${issue.title}</h2>
          <div class="date">发表于 ${new Date(issue.created_at).toLocaleDateString()}</div>
          ${tocHtml}
          <div class="content">${tempDiv.innerHTML}</div>
        </div>
      `;

      Prism.highlightAll();
    }
    loadPost();
  </script>
</body>
</html>
